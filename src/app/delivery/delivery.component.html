<!-- src/app/delivery/delivery.component.html -->
<div class="page">
  <h1>Delivery</h1>

  <div class="toolbar">
    <input [(ngModel)]="driverId" placeholder="Driver ID / phone" />
    <button
      (click)="createRun()"
      [disabled]="!driverId || selected.size===0 || loading"
    >
      Assign {{ selected.size }} order(s)
    </button>
    <span class="muted" *ngIf="loading">Working…</span>
    <span class="error" *ngIf="error">{{ error }}</span>
  </div>

  <div class="grid">
    <div class="card">
      <h3>Orders (select)</h3>
      <div class="list">
        <label *ngFor="let o of orders; trackBy: trackOrder">
          <input
            type="checkbox"
            [checked]="selected.has(o.orderId)"
            (change)="toggle(o.orderId)"
          />
          <span>
            {{ o.orderName || o.orderId }} — {{ o.shipTo?.name }}
            — {{ o.total }} {{ o.currency }}
          </span>
        </label>
      </div>
    </div>

    <div class="card">
      <h3>Today’s Runs</h3>
      <div *ngFor="let r of runs() ; trackBy: trackRun" class="run">
        <div class="run-head">
          Run {{ r.RUN_ID }} — Driver: {{ r.DRIVER_ID }} — {{ r.STATUS }}
        </div>
        <ul>
          <li *ngFor="let s of r.STOPS; trackBy: trackStop">
            #{{ s.ORDER_ID }} — {{ s.CUSTOMER_NAME }} —
            {{ s.ADDRESS }} — COD: {{ s.COD_AMOUNT }} — {{ s.STATUS }}
          </li>
        </ul>
      </div>
      <div class="muted" *ngIf="runs().length===0">No runs today.</div>
    </div>
  </div>
</div>
